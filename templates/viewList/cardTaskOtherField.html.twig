{#{% extends 'SonataAdminBundle:CRUD:base_list_field.html.twig' %}#}
{% extends '/viewList/base_show_field.html.twig' %}
{% block field %}
    {% if compare_mode is not defined %}
        <td>{{ block('field_title') }}</td>
    {% endif %}
    <td>{{ block('field_value') }}</td>
{% endblock %}

{% block field_title %}
    <table width="100%">
        {#        @var element \App\Classes\Card\CardShowHistoryInterface #}
{#        {% for element in value %}#}
            {% if value|length %}
                {% set element = value[value|length - 1]     %}
                {% set elementIndex = value|length - 1 %}
                {% for title in element.titles %}
                    <tr class="sonata-ba-view-container history-audit-compare">
                        {% if (value_compare is defined) %}
                            <th class="{{ (
                            (value_compare[elementIndex] is not defined and element.fields[loop.index-1]) or
                             (value_compare[elementIndex] is defined and element.fields[loop.index-1] != value_compare[elementIndex].fields[loop.index-1])
                            ) ? 'diff' : '' }}">{{ title }}</th>
                        {% else %}
                            <th>{{ title }}</th>
                        {% endif %}
                    </tr>
                {% endfor %}
            {% endif %}
{#        {% endfor %}#}
    </table>
{% endblock %}

{% block field_value %}
    <table width="100%">
        {#        @var element \App\Classes\Card\CardShowHistoryInterface #}
{#        {% for element in value %}#}
            {% if value|length %}
                {% set element = value[value|length - 1] %}
                {% for field in element.fields %}

                    {#            {{ dump(element) }}#}
                    <tr class="sonata-ba-view-container history-audit-compare">
                        <td>
                            {% if field_description.hasassociationadmin
                                and field_description.associationadmin.hasRoute(route_name)
                                and field_description.associationadmin.hasAccess(route_name, element) %}
                                <a href="{{ field_description.associationadmin.generateObjectUrl(route_name, element, field_description.options.route.parameters) }}">
                                    {{ field }}
                                </a>
                            {% else %}
                                {{ field }}
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
{#        {% endfor %}#}
    </table>
{% endblock %}

{% block field_compare %}
    {% if(value_compare is defined) %}
        {% set compare_mode = true %}
        {% set value = value_compare %}
        {{ block('field') }}
    {% endif %}
{% endblock %}
